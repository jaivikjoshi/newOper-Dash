"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[377],{1620:function(e,t,r){r.r(t),r.d(t,{MemberProvider:function(){return l},useMember:function(){return c}});var a=r(7437),o=r(2265),n=r(1223),i=r(3604);let s=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)([]),[c,u]=(0,o.useState)(!0),[d,g]=(0,o.useState)(null),[m,S]=(0,o.useState)([]),y=e=>{let t={};return e.forEach(e=>{Array.isArray(e.units)&&e.units.forEach(e=>{e&&(t[e]=(t[e]||0)+1)})}),t},p=async e=>{try{let t=await i.UL(n.t.SHEETS.ORGANIZATION_UNITS);for(let r in S(t),e)try{let t={members:e[r]};await i.RQ(n.t.SHEETS.ORGANIZATION_UNITS,r,t)}catch(e){console.error("Error updating member count for unit ".concat(r,":"),e)}}catch(e){console.error("Error loading organization units for count update:",e)}};(0,o.useEffect)(()=>{let e=async()=>{try{u(!0),g(null);try{let e=await i.UL(n.t.SHEETS.MEMBERS);if(e&&e.length>0){let t=e.map(e=>{let t=e.roles;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){console.warn("Could not parse roles:",t),t=[]}else Array.isArray(t)||(t=[]);let r=[];if(e.units){if("string"==typeof e.units)try{r=JSON.parse(e.units)}catch(t){console.warn("Could not parse units JSON:",e.units)}else Array.isArray(e.units)&&(r=e.units)}return 0===r.length&&e.unit&&"string"==typeof e.unit&&e.unit.trim()&&(r=[e.unit.trim()]),{...e,roles:t,units:r}});l(t);let r=y(t);p(r).catch(e=>{console.error("Failed to update unit counts on load:",e)}),u(!1);return}}catch(e){console.error("Error loading from Google Sheets, falling back to localStorage:",e)}let e=localStorage.getItem("organizationMembers");if(e)l(JSON.parse(e));else{let e=[{id:"1",name:"John Admin",email:"john@example.com",roles:["Administrator"],units:["1","2"],status:"active",createdAt:new Date().toISOString()},{id:"2",name:"Sarah Manager",email:"sarah@example.com",roles:["Manager"],units:["1"],status:"active",createdAt:new Date().toISOString()}];l(e),localStorage.setItem("organizationMembers",JSON.stringify(e))}}catch(e){console.error("Error loading member data:",e),g("Failed to load member data. Please try again later.")}finally{u(!1)}};e()},[]);let f=async e=>{try{let t={...e,createdAt:new Date().toISOString()};try{let e={...t,roles:JSON.stringify(t.roles||[]),units:JSON.stringify(t.units||[]),unit:Array.isArray(t.units)&&t.units.length>0?t.units[0]:""},a=await i.SA(n.t.SHEETS.MEMBERS,e),o={...a,roles:Array.isArray(a.roles)?a.roles:"string"==typeof a.roles&&a.roles?JSON.parse(a.roles):[],units:Array.isArray(a.units)?a.units:"string"==typeof a.units&&a.units?JSON.parse(a.units):[]},s=[...r,o];l(s);let c=y(s);return p(c).catch(e=>{console.error("Failed to update unit counts after adding member:",e)}),o}catch(e){console.error("Error adding to Google Sheets, falling back to localStorage:",e)}let a=Date.now().toString(),o={...t,id:a,roles:Array.isArray(t.roles)?t.roles:[],units:Array.isArray(t.units)?t.units:[]},s=[...r,o];l(s),localStorage.setItem("organizationMembers",JSON.stringify(s));let c=y(s);return p(c).catch(e=>{console.error("Failed to update unit counts after adding member (localStorage):",e)}),o}catch(e){throw console.error("Error adding member:",e),Error("Failed to add member. Please try again later.")}},h=async(e,t)=>{try{let a={...t,roles:Array.isArray(t.roles)?t.roles:void 0,units:Array.isArray(t.units)?t.units:void 0};try{let o={...t};t.roles&&(o.roles=JSON.stringify(t.roles)),t.units&&(o.units=JSON.stringify(t.units),Array.isArray(t.units)&&t.units.length>0?o.unit=t.units[0]:o.unit="");let s=await i.RQ(n.t.SHEETS.MEMBERS,e,o);if(s){let t=r.map(t=>t.id===e?{...t,...a,roles:a.roles||t.roles,units:a.units||t.units}:t);l(t);let o=y(t);return p(o).catch(e=>{console.error("Failed to update unit counts after updating member:",e)}),!0}}catch(e){console.error("Error updating in Google Sheets, falling back to localStorage:",e)}let o=r.map(t=>t.id===e?{...t,...a,roles:a.roles||t.roles,units:a.units||t.units}:t);l(o),localStorage.setItem("organizationMembers",JSON.stringify(o));let s=y(o);return p(s).catch(e=>{console.error("Failed to update unit counts after updating member (localStorage):",e)}),!0}catch(e){return console.error("Error updating member:",e),!1}},E=async e=>{try{try{let t=await i.qK(n.t.SHEETS.MEMBERS,e);if(t){let t=r.filter(t=>t.id!==e);l(t);let a=y(t);return p(a).catch(e=>{console.error("Failed to update unit counts after deleting member:",e)}),!0}}catch(e){console.error("Error deleting from Google Sheets, falling back to localStorage:",e)}let t=r.filter(t=>t.id!==e);l(t),localStorage.setItem("organizationMembers",JSON.stringify(t));let a=y(t);return p(a).catch(e=>{console.error("Failed to update unit counts after deleting member (localStorage):",e)}),!0}catch(e){return console.error("Error deleting member:",e),!1}};return(0,a.jsx)(s.Provider,{value:{members:r,loading:c,error:d,addMember:f,updateMember:h,deleteMember:E,searchMembers:e=>{let t=e.toLowerCase();return r.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))},getMembersByUnit:e=>r.filter(t=>t.units.includes(e)),recalculateUnitCounts:()=>{let e=y(r);p(e).catch(e=>{console.error("Failed to update unit counts in sheets:",e)})}},children:t})},c=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useMember must be used within a MemberProvider");return e}},6884:function(e,t,r){r.r(t),r.d(t,{OrganizationProvider:function(){return l},useOrganization:function(){return c}});var a=r(7437),o=r(2265),n=r(1223),i=r(3604);let s=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)([]),[c,u]=(0,o.useState)(!0),[d,g]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let e=async()=>{try{u(!0),g(null);try{let e=await i.UL(n.t.SHEETS.ORGANIZATION_UNITS);if(e&&e.length>0){let t=e.map(e=>({...e,members:e.members?Number(e.members):void 0,capacity:e.capacity?Number(e.capacity):void 0}));l(t),u(!1);return}}catch(e){console.error("Error loading data from Google Sheets:",e)}let e=localStorage.getItem("organizationUnits");if(e)try{let t=JSON.parse(e);l(t),u(!1);return}catch(e){console.error("Error parsing localStorage data:",e),localStorage.removeItem("organizationUnits")}let t=[{id:"1",name:"Operations Team",type:"team",description:"Main operations team",members:12,createdAt:new Date().toISOString()},{id:"2",name:"North Location",type:"location",description:"North branch operations",address:"123 North St, City",capacity:50,createdAt:new Date().toISOString()},{id:"3",name:"Sales Department",type:"department",description:"Sales and business development",members:8,createdAt:new Date().toISOString()},{id:"4",name:"Supervisor",type:"role",description:"Team supervisors",level:"Mid-management",createdAt:new Date().toISOString()}];l(t),localStorage.setItem("organizationUnits",JSON.stringify(t))}catch(e){console.error("Error loading organization data:",e),g("Failed to load organization data. Please try again later.")}finally{u(!1)}};e()},[]),(0,a.jsx)(s.Provider,{value:{units:r,isLoading:c,addUnit:e=>{try{let t={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};try{let e={...t,members:t.members?String(t.members):"0",capacity:t.capacity?String(t.capacity):void 0};Object.keys(e).forEach(t=>{void 0===e[t]&&delete e[t]}),i.SA(n.t.SHEETS.ORGANIZATION_UNITS,e).catch(e=>console.error("Error adding unit to Google Sheets:",e))}catch(e){console.error("Error preparing data for Google Sheets:",e)}l(e=>[...e,t]),localStorage.setItem("organizationUnits",JSON.stringify([...r,t]))}catch(e){throw console.error("Error adding unit:",e),Error("Failed to add unit. Please try again later.")}},updateUnit:(e,t)=>{try{try{let r={...t,members:t.members?String(t.members):void 0,capacity:t.capacity?String(t.capacity):void 0};Object.keys(r).forEach(e=>{void 0===r[e]&&delete r[e]}),i.RQ(n.t.SHEETS.ORGANIZATION_UNITS,e,r).catch(e=>console.error("Error updating unit in Google Sheets:",e))}catch(e){console.error("Error preparing data for Google Sheets:",e)}l(r=>r.map(r=>r.id===e?{...r,...t}:r)),localStorage.setItem("organizationUnits",JSON.stringify(r.map(r=>r.id===e?{...r,...t}:r)))}catch(e){throw console.error("Error updating unit:",e),Error("Failed to update unit. Please try again later.")}},deleteUnit:e=>{try{l(t=>t.filter(t=>t.id!==e)),localStorage.setItem("organizationUnits",JSON.stringify(r.filter(t=>t.id!==e)))}catch(e){throw console.error("Error deleting unit:",e),Error("Failed to delete unit. Please try again later.")}},searchUnits:e=>{if(!e)return r;let t=e.toLowerCase();return r.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))},filterUnitsByType:e=>"all"===e?r:r.filter(t=>t.type===e),updateUnitMemberCounts:e=>{try{let t=r.map(t=>{if(e.hasOwnProperty(t.id)){try{let r={members:e[t.id]};(async()=>{try{await i.RQ(n.t.SHEETS.ORGANIZATION_UNITS,t.id,r)}catch(e){console.error("Error updating member count for unit ".concat(t.id," in Google Sheets:"),e)}})()}catch(e){console.error("Error preparing data for Google Sheets:",e)}return{...t,members:e[t.id]}}return t});l(t),localStorage.setItem("organizationUnits",JSON.stringify(t))}catch(e){console.error("Error updating unit member counts:",e)}}},children:t})},c=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e}}}]);