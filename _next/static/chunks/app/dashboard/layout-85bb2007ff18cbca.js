(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{6724:function(e,t,s){Promise.resolve().then(s.bind(s,9832))},9832:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Y}});var a=s(7437),r=s(8757),n=s.n(r),i=s(6691),l=s.n(i),o=s(1396),c=s.n(o),d=s(4033),m=s(5119),f=s(3021),u=s(2812),x=s(9036),h=s(9409),g=s(7972),p=s(3523),b=s(5883),j=s(2265),y=s(7260),N=s(3023),v=s(8305),w=s(9213),k=s(2549),C=s(9311);let z=v.fC,R=v.xz;v.x8;let S=v.h_,E=j.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.aV,{className:(0,C.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});E.displayName=v.aV.displayName;let _=(0,w.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Z=j.forwardRef((e,t)=>{let{side:s="right",className:r,children:n,...i}=e;return(0,a.jsxs)(S,{children:[(0,a.jsx)(E,{}),(0,a.jsxs)(v.VY,{ref:t,className:(0,C.cn)(_({side:s}),r),...i,children:[n,(0,a.jsxs)(v.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});Z.displayName=v.VY.displayName;let P=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,C.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};P.displayName="SheetHeader";let O=j.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.Dx,{ref:t,className:(0,C.cn)("text-lg font-semibold text-foreground",s),...r})});O.displayName=v.Dx.displayName;let V=j.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.dk,{ref:t,className:(0,C.cn)("text-sm text-muted-foreground",s),...r})});V.displayName=v.dk.displayName;var A=s(6503);let D=j.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(A.fC,{ref:t,className:(0,C.cn)("relative overflow-hidden",s),...n,children:[(0,a.jsx)(A.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(L,{}),(0,a.jsx)(A.Ns,{})]})});D.displayName=A.fC.displayName;let L=j.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...n}=e;return(0,a.jsx)(A.gb,{ref:t,orientation:r,className:(0,C.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,a.jsx)(A.q4,{className:"relative flex-1 rounded-full bg-border"})})});async function T(){try{let e=await fetch("/api/notifications"),t=await e.json();return t}catch(e){return console.error("Error fetching notifications:",e),{notifications:[],error:"Failed to fetch notifications"}}}async function U(e){try{let t=await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),s=await t.json();return s.success}catch(e){return console.error("Error marking notification as read:",e),!1}}async function B(){try{let e=await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markAll:!0})}),t=await e.json();return t.success}catch(e){return console.error("Error marking all notifications as read:",e),!1}}function F(){let[e,t]=(0,j.useState)(!1),[s,r]=(0,j.useState)([]),[n,i]=(0,j.useState)(!0),[l,o]=(0,j.useState)(null),c=s.filter(e=>!e.isRead).length;(0,j.useEffect)(()=>{d()},[]);let d=async()=>{try{i(!0);let e=await T();e.error?o(e.error):(r(e.notifications),o(null))}catch(e){o("Failed to fetch notifications")}finally{i(!1)}},m=async e=>{let t=await U(e);t&&r(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t))},u=async()=>{let e=await B();e&&r(e=>e.map(e=>({...e,isRead:!0})))};return(0,a.jsxs)(z,{open:e,onOpenChange:t,children:[(0,a.jsx)(R,{asChild:!0,children:(0,a.jsxs)(N.z,{variant:"ghost",size:"icon",className:"relative",children:[(0,a.jsx)(f.Z,{className:"h-5 w-5"}),c>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-red-500 text-[10px] font-medium text-white flex items-center justify-center",children:c})]})}),(0,a.jsxs)(Z,{className:"w-[400px] sm:w-[540px]",children:[(0,a.jsx)(P,{className:"space-y-2.5 pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(O,{children:"Notifications"}),s.length>0&&(0,a.jsx)(N.z,{variant:"outline",size:"sm",onClick:u,className:"text-xs",children:"Mark all as read"})]})}),(0,a.jsx)(D,{className:"h-[calc(100vh-8rem)]",children:n?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Loading notifications..."})}):l?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)("p",{className:"text-sm text-red-500",children:l})}):0===s.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No notifications"})}):(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg ".concat(e.isRead?"bg-gray-50":"bg-blue-50"),onClick:()=>!e.isRead&&m(e.id),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.text}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["By ",e.by]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"â€¢"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.date})]})]}),!e.isRead&&(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-blue-500"})]})},e.id))})})]})]})}function I(e){let{children:t}=e,{isAuthenticated:s,loading:r}=(0,y.useUser)(),n=(0,d.useRouter)();return((0,j.useEffect)(()=>{r||s||n.push("/login")},[s,r,n]),r)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):s?(0,a.jsx)(a.Fragment,{children:t}):null}function Y(e){let{children:t}=e,s=(0,d.usePathname)(),r=(0,d.useRouter)(),{userProfile:i,logout:o}=(0,y.useUser)(),[N,v]=(0,j.useState)(!1),w=(0,j.useRef)(null),k=[{name:"Dashboard",href:"/dashboard",icon:m.Z},{name:"Announcements",href:"/dashboard/announcements",icon:f.Z},{name:"Organizations",href:"/dashboard/organizations",icon:u.Z,subItems:[{name:"Progress",href:"/dashboard/organizations?tab=progress"}]},{name:"RBAC Demo",href:"/dashboard/rbac-demo",icon:x.Z},{name:"Settings",href:"/dashboard/settings",icon:h.Z}];(0,j.useEffect)(()=>{function e(e){w.current&&!w.current.contains(e.target)&&v(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let C=()=>{o(),r.push("/login")};return(0,a.jsx)(I,{children:(0,a.jsxs)("div",{className:"".concat(n().className," flex h-screen bg-[#e9e2fe]"),children:[(0,a.jsxs)("div",{className:"w-[200px] bg-white flex flex-col shadow-sm",children:[(0,a.jsx)("div",{className:"p-4 border-b flex items-center justify-center",children:(0,a.jsx)(l(),{src:"/images/main-logo.png",alt:"Knowbie Logo",width:100,height:30,priority:!0})}),(0,a.jsxs)("nav",{className:"flex-1 py-6 flex flex-col gap-2",children:[k.map(e=>{let t=e.icon,r=s===e.href||s.startsWith(e.href+"/");return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)(c(),{href:e.href,className:"flex items-center gap-3 px-4 py-2.5 mx-2 rounded-md ".concat(r?"bg-[#e9e2fe] text-[#3a2a6d] font-medium":"text-gray-500 hover:bg-gray-100"),children:[(0,a.jsx)(t,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]}),e.subItems&&r&&(0,a.jsx)("div",{className:"ml-11 mt-2 space-y-2",children:e.subItems.map(t=>(0,a.jsx)(c(),{href:t.href,className:"block text-sm py-1.5 ".concat(s===t.href||s===e.href&&t.href.includes("?tab=progress")?"text-[#3a2a6d] font-medium":"text-gray-500 hover:text-gray-700"),children:t.name},t.name))})]},e.name)}),(0,a.jsxs)("div",{className:"mb-1 relative",ref:w,children:[(0,a.jsxs)("button",{onClick:()=>v(!N),className:"w-full flex items-center gap-3 px-4 py-2.5 mx-2 rounded-md text-gray-500 hover:bg-gray-100",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:(null==i?void 0:i.profilePicture)?(0,a.jsx)("img",{src:i.profilePicture,alt:"Profile",className:"w-full h-full object-cover"}):(0,a.jsx)(g.Z,{className:"h-3 w-3 text-gray-500"})}),(0,a.jsx)("span",{className:"text-sm",children:(null==i?void 0:i.name)||"User"}),(0,a.jsx)(p.Z,{size:16,className:"ml-auto text-gray-500"})]}),N&&(0,a.jsxs)("div",{className:"absolute left-0 mt-1 w-[200px] bg-white shadow-lg z-50",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsx)("p",{className:"text-lg font-medium",children:(null==i?void 0:i.name)||"User"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==i?void 0:i.email)||"user@example.com"})]}),(0,a.jsxs)("div",{className:"py-1",children:[(0,a.jsx)(c(),{href:"/dashboard/settings",className:"block px-4 py-3 text-gray-700 hover:bg-gray-100",onClick:()=>v(!1),children:"Settings"}),(0,a.jsx)(c(),{href:"/dashboard/settings?tab=profile",className:"block px-4 py-3 text-gray-700 hover:bg-gray-100",onClick:()=>v(!1),children:"Your Profile"}),(0,a.jsx)(c(),{href:"/dashboard/settings?tab=notifications",className:"block px-4 py-3 text-gray-700 hover:bg-gray-100",onClick:()=>v(!1),children:"Notifications"})]}),(0,a.jsx)("div",{className:"border-t",children:(0,a.jsx)("button",{onClick:C,className:"w-full text-left block px-4 py-3 text-red-600 hover:bg-gray-100",children:"Sign out"})})]})]})]}),(0,a.jsx)("div",{className:"p-4 border-t",children:(0,a.jsxs)("button",{onClick:C,className:"flex w-full items-center gap-3 px-4 py-2.5 text-red-500 hover:bg-gray-100 rounded-md",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"text-sm",children:"Sign out"})]})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto relative",children:[t,(0,a.jsx)(F,{})]})]})})}L.displayName=A.gb.displayName},3023:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var a=s(7437),r=s(2265),n=s(3474),i=s(9213),l=s(9311);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:c=!1,...d}=e,m=c?n.g7:"button";return(0,a.jsx)(m,{className:(0,l.cn)(o({variant:r,size:i,className:s})),ref:t,...d})});c.displayName="Button"},9311:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(7042),r=s(4769);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[555,396,758,307,260,971,864,744],function(){return e(e.s=6724)}),_N_E=e.O()}]);